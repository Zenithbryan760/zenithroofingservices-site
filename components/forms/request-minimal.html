<!-- /components/forms/request-minimal.html -->
<section class="reins-form" aria-label="Request form">
  <style>
    /* minimal, reuse existing form grid classes */
    .reins-form .sr-only{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,1px,1px);white-space:nowrap;border:0}
  </style>

  <form id="re-minimal-form" method="POST" novalidate>
    <!-- Hidden context (auto-filled by script) -->
    <input type="hidden" name="page" value="">
    <input type="hidden" name="category" value="">
    <!-- Honeypot -->
    <input type="text" name="website" tabindex="-1" autocomplete="off" class="sr-only" aria-hidden="true">

    <!-- Row 1 -->
    <div class="form-row">
      <div class="form-group form-col-6">
        <label for="first_name">First Name*</label>
        <input id="first_name" name="first_name" placeholder="First name" required>
        <div class="field-error" aria-live="polite"></div>
      </div>
      <div class="form-group form-col-6">
        <label for="last_name">Last Name*</label>
        <input id="last_name" name="last_name" placeholder="Last name" required>
        <div class="field-error" aria-live="polite"></div>
      </div>
    </div>

    <!-- Row 2 -->
    <div class="form-row">
      <div class="form-group form-col-6">
        <label for="phone">Phone*</label>
        <input id="phone" name="phone" inputmode="tel" autocomplete="tel" placeholder="(555) 555-5555" required>
        <div class="field-error" aria-live="polite"></div>
      </div>
      <div class="form-group form-col-6">
        <label for="email">Email</label>
        <input id="email" name="email" type="email" autocomplete="email" placeholder="you@example.com">
        <div class="field-error" aria-live="polite"></div>
      </div>
    </div>

    <!-- Row 3 -->
    <div class="form-row">
      <div class="form-group form-col-6">
        <label for="street_address">Property Address*</label>
        <input id="street_address" name="street_address" autocomplete="street-address" placeholder="123 Main St" required>
        <div class="field-error" aria-live="polite"></div>
      </div>
      <div class="form-group form-col-4">
        <label for="city">City*</label>
        <input id="city" name="city" placeholder="City" required>
        <div class="field-error" aria-live="polite"></div>
      </div>
      <div class="form-group form-col-4">
        <label for="state">State*</label>
        <input id="state" name="state" placeholder="CA" maxlength="2" required>
        <div class="field-error" aria-live="polite"></div>
      </div>
      <div class="form-group form-col-4">
        <label for="zip">ZIP*</label>
        <input id="zip" name="zip" inputmode="numeric" pattern="[0-9]*" placeholder="92025" required>
        <div class="field-error" aria-live="polite"></div>
      </div>
    </div>

    <!-- Row 4 -->
    <div class="form-row">
      <div class="form-group form-col-6">
        <label for="serviceType" class="sr-only">Service Type*</label>
        <select id="serviceType" name="service_type" required>
          <option value="" selected disabled hidden>Service Type*</option>
          <!-- Real-Estate / Inspections options -->
          <option>Visual Roof Inspection ($295)</option>
          <option>Real-Estate Roof Estimate ($295)</option>
          <option>Roof Certification ($395)</option>
          <option>Certified Roof Report ($495)</option>
          <option>Verbal Roof Opinion</option>
          <option>Satellite Imagery Analysis</option>
          <option>Homeowner Roof Inspection</option>
          <option>Insurance Letter / Third Party Request ($295)</option>
          <option>Storm Damage Inspection for Claim</option>
          <option>Other / Not sure</option>
        </select>
        <div class="field-error" aria-live="polite"></div>
      </div>
      <div class="form-group form-col-6">
        <label for="referral_source">How did you hear about us?</label>
        <select id="referral_source" name="referral_source">
          <option value="">Selectâ€¦</option>
          <option>Google</option><option>Yelp</option><option>Referral</option>
          <option>Realtor</option><option>Sign/Truck</option><option>Other</option>
        </select>
      </div>
    </div>

    <!-- Row 5 -->
    <div class="form-row">
      <div class="form-group">
        <label for="description">Notes for our team</label>
        <textarea id="description" name="description" placeholder="Share transaction status, what you need in writing, or anything urgent."></textarea>
      </div>
    </div>

    <!-- reCAPTCHA slot (estimate-form.js renders here) -->
    <div class="form-row">
      <div class="form-group">
        <div class="recaptcha-container"><div id="recaptcha-slot"></div></div>
      </div>
    </div>

    <!-- Actions -->
    <div class="form-row">
      <div class="form-group">
        <button type="submit" class="zenith-btn" data-default-cta="Send Request">Send Request</button>
      </div>
    </div>
  </form>

  <script>
    (function(){
      // Read per-page attributes to preselect/lock service and customize CTA
      const host = document.currentScript.closest('[data-estimate-context]') || document;
      const form = host.querySelector('#re-minimal-form') || document.getElementById('re-minimal-form');
      if (!form) return;

      const get = n => form.querySelector(\`[name="\${n}"]\`);
      const svc   = form.querySelector('#serviceType');
      const btn   = form.querySelector('button[type="submit"]');

      const ctx   = host.getAttribute('data-estimate-context') || '';
      const cat   = host.getAttribute('data-category') || '';
      const redir = host.getAttribute('data-redirect') || '';
      const svcLabel = host.getAttribute('data-service') || '';
      const lockSvc  = (host.getAttribute('data-lock-service')||'').toLowerCase()==='true';
      const ctaLabel = host.getAttribute('data-cta') || '';

      if (get('page'))     get('page').value = location.pathname;
      if (get('category')) get('category').value = cat || document.title;

      if (svcLabel && svc) {
        let matched = false;
        for (const opt of svc.options) {
          if (opt.text.trim().toLowerCase() === svcLabel.trim().toLowerCase()) {
            opt.selected = true; matched = true; break;
          }
        }
        if (!matched) {
          const o = document.createElement('option');
          o.textContent = svcLabel; o.selected = true;
          svc.insertBefore(o, svc.firstChild);
        }
        if (lockSvc) svc.setAttribute('disabled','disabled');
      }

      if (ctaLabel && btn) btn.textContent = ctaLabel;

      // Use your existing initializer (validation + reCAPTCHA + JobNimbus submit + redirect)
      if (window.initEstimateForm) {
        window.initEstimateForm(form, { redirect: redir });
      }
    })();
  </script>
</section>
